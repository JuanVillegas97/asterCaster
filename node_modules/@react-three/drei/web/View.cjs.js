"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("react"),t=require("three"),r=require("@react-three/fiber");function n(e){if(e&&e.__esModule)return e;var t=Object.create(null);return e&&Object.keys(e).forEach((function(r){if("default"!==r){var n=Object.getOwnPropertyDescriptor(e,r);Object.defineProperty(t,r,n.get?n:{enumerable:!0,get:function(){return e[r]}})}})),t.default=e,Object.freeze(t)}var c=n(e),i=n(t);const s=new i.Color;function a({canvasSize:e,scene:t,index:n,children:i,frames:a,rect:o,track:u}){const l=r.useThree((e=>e.get)),h=r.useThree((e=>e.camera)),g=r.useThree((e=>e.scene)),d=r.useThree((e=>e.setEvents));let f=0;return r.useFrame((r=>{var n,c;(a===1/0||f<=a)&&(o.current=null==(n=u.current)?void 0:n.getBoundingClientRect(),f++);if(o.current){const{left:n,right:a,top:u,bottom:l,width:d,height:f}=o.current,p=l<0||u>e.height||a<0||n>e.width,m=e.height-l,v=d/f;if((c=h)&&c.isOrthographicCamera?h.left===d/-2&&h.right===d/2&&h.top===f/2&&h.bottom===f/-2||(Object.assign(h,{left:d/-2,right:d/2,top:f/2,bottom:f/-2}),h.updateProjectionMatrix()):h.aspect!==v&&(h.aspect=v,h.updateProjectionMatrix()),r.gl.setViewport(n,m,d,f),r.gl.setScissor(n,m,d,f),r.gl.setScissorTest(!0),p)return r.gl.getClearColor(s),r.gl.setClearColor(s,r.gl.getClearAlpha()),void r.gl.clear(!0,!0);r.gl.render(i?g:t,h)}}),n),c.useEffect((()=>{const e=l().events.connected;return d({connected:u.current}),()=>d({connected:e})}),[]),c.createElement(c.Fragment,null,i)}exports.View=({track:e,index:t=1,frames:n=1/0,children:s})=>{const o=c.useRef(null),{size:u,scene:l}=r.useThree(),[h]=c.useState((()=>new i.Scene)),g=c.useCallback(((t,r)=>{if(e.current&&t.target===e.current){const{width:e,height:n,left:c,top:i}=o.current,s=t.clientX-c,a=t.clientY-i;r.pointer.set(s/e*2-1,-a/n*2+1),r.raycaster.setFromCamera(r.pointer,r.camera)}}),[o]),[d,f]=c.useReducer((()=>!0),!1);return c.useEffect((()=>{var t;o.current=null==(t=e.current)?void 0:t.getBoundingClientRect(),f()}),[]),d&&r.createPortal(c.createElement(a,{canvasSize:u,frames:n,scene:l,track:e,rect:o,index:t},s),h,{events:{compute:g,priority:t},size:{width:o.current.width,height:o.current.height}})};
