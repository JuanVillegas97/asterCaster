"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("@babel/runtime/helpers/extends"),n=require("react"),r=require("@react-three/fiber"),t=require("three"),u=require("three-stdlib"),o=require("../helpers/environment-assets.cjs.js");function a(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}function c(e){if(e&&e.__esModule)return e;var n=Object.create(null);return e&&Object.keys(e).forEach((function(r){if("default"!==r){var t=Object.getOwnPropertyDescriptor(e,r);Object.defineProperty(n,r,t.get?t:{enumerable:!0,get:function(){return e[r]}})}})),n.default=e,Object.freeze(n)}var s=a(e),i=c(n);const l=e=>{return(n=e).current&&n.current.isScene?e.current:e;var n};function d({scene:e,background:n=!1,map:t}){const u=r.useThree((e=>e.scene));return i.useLayoutEffect((()=>{if(t){const r=l(e||u),o=r.background,a=r.environment;return"only"!==n&&(r.environment=t),n&&(r.background=t),()=>{"only"!==n&&(r.environment=a),n&&(r.background=o)}}}),[u,e,t,n]),null}function p({files:e=["/px.png","/nx.png","/py.png","/ny.png","/pz.png","/nz.png"],path:n="",preset:a,encoding:c,extensions:s}){if(a){if(!(a in o.presetsObj))throw new Error("Preset must be one of: "+Object.keys(o.presetsObj).join(", "));e=o.presetsObj[a],n="https://market-assets.fra1.cdn.digitaloceanspaces.com/market-assets/hdris/"}const i=Array.isArray(e),l=i?t.CubeTextureLoader:u.RGBELoader,d=r.useLoader(l,i?[e]:e,(e=>{e.setPath(n),s&&s(e)})),p=i?d[0]:d;return p.mapping=i?t.CubeReflectionMapping:t.EquirectangularReflectionMapping,p.encoding=(null!=c?c:i)?t.sRGBEncoding:t.LinearEncoding,p}function m({background:e=!1,scene:n,...t}){const u=p(t),o=r.useThree((e=>e.scene));return i.useLayoutEffect((()=>{const r=l(n||o),t=r.background,a=r.environment;return"only"!==e&&(r.environment=u),e&&(r.background=u),()=>{"only"!==e&&(r.environment=a),e&&(r.background=t)}}),[u,e,n,o]),null}function g({children:e,near:n=1,far:u=1e3,resolution:o=256,frames:a=1,map:c,background:s=!1,scene:p,files:g,path:f,preset:b,extensions:v}){const E=r.useThree((e=>e.gl)),h=r.useThree((e=>e.scene)),y=i.useRef(null),[x]=i.useState((()=>new t.Scene)),k=i.useMemo((()=>{const e=new t.WebGLCubeRenderTarget(o);return e.texture.type=t.HalfFloatType,e}),[o]);i.useLayoutEffect((()=>{1===a&&y.current.update(E,x);const e=l(p||h),n=e.background,r=e.environment;return"only"!==s&&(e.environment=k.texture),s&&(e.background=k.texture),()=>{"only"!==s&&(e.environment=r),s&&(e.background=n)}}),[e,x,k.texture,p,h,s,a,E]);let j=1;return r.useFrame((()=>{(a===1/0||j<a)&&(y.current.update(E,x),j++)})),i.createElement(i.Fragment,null,r.createPortal(i.createElement(i.Fragment,null,e,i.createElement("cubeCamera",{ref:y,args:[n,u,k]}),g||b?i.createElement(m,{background:!0,files:g,preset:b,path:f,extensions:v}):c?i.createElement(d,{background:!0,map:c,extensions:v}):null),x))}function f(e){var n,t,o,a;const c=p(e),l=e.map||c;i.useMemo((()=>{r.extend({GroundProjectedEnvImpl:u.GroundProjectedEnv})}),[]);const m=i.useMemo((()=>[l]),[l]),g=null==(n=e.ground)?void 0:n.height,f=null==(t=e.ground)?void 0:t.radius,b=null!==(o=null==(a=e.ground)?void 0:a.scale)&&void 0!==o?o:1e3;return i.createElement(i.Fragment,null,i.createElement(d,s.default({},e,{map:l})),i.createElement("groundProjectedEnvImpl",{args:m,scale:b,height:g,radius:f}))}exports.Environment=function(e){return e.ground?i.createElement(f,e):e.map?i.createElement(d,e):e.children?i.createElement(g,e):i.createElement(m,e)},exports.EnvironmentCube=m,exports.EnvironmentMap=d,exports.EnvironmentPortal=g,exports.useEnvironment=p;
